<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Optical Transfer Functions" href="otf.html" /><link rel="prev" title="Installation" href="installation.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Deconvolution - pycudadecon</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #263238;
  --color-code-foreground: #EEFFFF;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #263238;
  --color-code-foreground: #EEFFFF;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">pycudadecon</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">pycudadecon</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Deconvolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="otf.html">Optical Transfer Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="affine.html">Affine Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/tlambert03/pycudadecon">Source Code</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="deconvolution">
<h1>Deconvolution<a class="headerlink" href="#deconvolution" title="Permalink to this headline">¶</a></h1>
<p>The primary function for performing deconvolution is <a class="reference internal" href="#pycudadecon.decon" title="pycudadecon.decon"><code class="xref py py-func docutils literal notranslate"><span class="pre">decon()</span></code></a>.</p>
<p>This convenience function is capable of receiving a variety of input types
(filenames, directory names, numpy arrays, or a list of any of those) and
will handle setting up and breaking down the FFT plan on the GPU for all files
being deconvolved.  Keywords arguments will be passed internally to the
<a class="reference internal" href="#pycudadecon.RLContext" title="pycudadecon.RLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RLContext</span></code></a> context manager or the
<a class="reference internal" href="otf.html#pycudadecon.make_otf" title="pycudadecon.make_otf"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_otf()</span></code></a> <a class="reference internal" href="#pycudadecon.rl_decon" title="pycudadecon.rl_decon"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_decon()</span></code></a> functions.</p>
<p>The setup and breakdown for the GPU-deconvolution can also be performed
manually:</p>
<ol class="simple">
<li><p>call <a class="reference internal" href="#pycudadecon.rl_init" title="pycudadecon.rl_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_init()</span></code></a> with the shape of the raw data and path to
OTF file.</p></li>
<li><p>perform deconvolution(s) with <a class="reference internal" href="#pycudadecon.rl_decon" title="pycudadecon.rl_decon"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_decon()</span></code></a>.</p></li>
<li><p>cleanup with <a class="reference internal" href="#pycudadecon.rl_cleanup" title="pycudadecon.rl_cleanup"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_cleanup()</span></code></a></p></li>
</ol>
<p>As a convenience, the <a class="reference internal" href="#pycudadecon.RLContext" title="pycudadecon.RLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RLContext</span></code></a> context manager will
perform the setup and breakdown automatically:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">tiffile</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'some_file.tif'</span><span class="p">)</span> <span class="n">otf</span> <span class="o">=</span> <span class="s1">'path_to_otf.tif'</span> <span class="k">with</span>
<span class="n">RLContext</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">otf</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">rl_decon</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output_shape</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">out_shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="module-pycudadecon">
<span id="api"></span><h2>API<a class="headerlink" href="#module-pycudadecon" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="pycudadecon.RLContext">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">pycudadecon.</span></code><code class="sig-name descname"><span class="pre">RLContext</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rawdata_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">otfpath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dzdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dxdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dzpsf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dxpsf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deskew</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pycudadecon/deconvolution.html#RLContext"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pycudadecon.RLContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Context manager to setup the GPU for RL decon</p>
<p>Takes care of handing the OTF to the GPU, preparing a cuFFT plane,
and cleaning up after decon.  Internally, this calls <a class="reference internal" href="#pycudadecon.rl_init" title="pycudadecon.rl_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_init()</span></code></a>,
stores the shape of the expected output volume after any deskew/decon,
then calls <a class="reference internal" href="#pycudadecon.rl_cleanup" title="pycudadecon.rl_cleanup"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_cleanup()</span></code></a> when exiting the context.</p>
<p>For parameters, see <a class="reference internal" href="#pycudadecon.rl_init" title="pycudadecon.rl_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_init()</span></code></a>.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">RLContext</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">otfpath</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">result</span> <span class="o">=</span> <span class="n">rl_decon</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">out_shape</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>
<dl class="py function">
<dt id="pycudadecon.decon">
<code class="sig-prename descclassname"><span class="pre">pycudadecon.</span></code><code class="sig-name descname"><span class="pre">decon</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fpattern</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'*.tif'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pycudadecon/deconvolution.html#decon"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pycudadecon.decon" title="Permalink to this definition">¶</a></dt>
<dd><p>Deconvolve an image or images with a PSF or OTF file.</p>
<p>If <cite>images</cite> is a directory, use the <cite>fpattern</cite> argument to select files
by filename pattern.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>np.ndarray</em><em>, or </em><em>sequence of either</em>) – The array, filepath, directory, or list/tuple thereof to deconvolve</p></li>
<li><p><strong>psf</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em> or </em><em>np.ndarray</em>) – a filepath of a PSF or OTF file, or a 3D numpy PSF array.  Function will
auto-detect whether the file is a 3D PSF or a filepath representing a 2D
complex OTF.</p></li>
<li><p><strong>fpattern</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>optional</em>) – Filepattern to use when a directory is provided in the <cite>images</cite> argument,
by default <cite>*.tif</cite></p></li>
<li><p><strong>kwargs</strong> (<em>**</em>) – All other kwargs must be valid for either <a class="reference internal" href="#pycudadecon.rl_init" title="pycudadecon.rl_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_init()</span></code></a> or <a class="reference internal" href="#pycudadecon.rl_decon" title="pycudadecon.rl_decon"><code class="xref py py-func docutils literal notranslate"><span class="pre">rl_decon()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The deconvolved image(s)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray or list of array</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.9)"><strong>ValueError</strong></a> – If save_deskewed is True and deskew is unset or 0</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#IOError" title="(in Python v3.9)"><strong>IOError</strong></a> – If a directory is provided as input and <code class="docutils literal notranslate"><span class="pre">fpattern</span></code> yields no files</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#NotImplementedError" title="(in Python v3.9)"><strong>NotImplementedError</strong></a> – If <code class="docutils literal notranslate"><span class="pre">psf</span></code> is provided as a complex, 2D numpy array (OTFs can only be
    provided as filenames created with <a class="reference internal" href="otf.html#pycudadecon.make_otf" title="pycudadecon.make_otf"><code class="xref py py-func docutils literal notranslate"><span class="pre">pycudadecon.make_otf()</span></code></a>)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>deconvolve a 3D TIF volume with a 3D PSF volume (e.g. a single bead stack)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">decon</span><span class="p">(</span><span class="s1">'/path/to/image.tif'</span><span class="p">,</span> <span class="s1">'/path/to/psf.tif'</span><span class="p">)</span>
</pre></div>
</div>
<p>deconvolve all TIF files in a specific directory that match a certain
<a class="reference external" href="https://docs.python.org/3.6/library/fnmatch.html">filename pattern</a>,
(in this example, all TIFs with the string ‘560nm’ in their name)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">decon</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s1">'/directory/with/images'</span><span class="p">,</span> <span class="s1">'/path/to/psf.tif'</span><span class="p">,</span> <span class="n">fpattern</span><span class="o">=</span><span class="s1">'*560nm*.tif'</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>deconvolve a list of images, provided either as np.ndarrays, filepaths,
or directories</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">imarray</span> <span class="o">=</span> <span class="n">tifffile</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'some_other_image.tif'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'/directory/with/images'</span><span class="p">,</span> <span class="s1">'/path/to/image.tif'</span><span class="p">,</span> <span class="n">imarray</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">decon</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="s1">'/path/to/psf.tif'</span><span class="p">,</span> <span class="n">fpattern</span><span class="o">=</span><span class="s1">'*560nm*.tif'</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>
<dl class="py function">
<dt id="pycudadecon.rl_cleanup">
<code class="sig-prename descclassname"><span class="pre">pycudadecon.</span></code><code class="sig-name descname"><span class="pre">rl_cleanup</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pycudadecon/deconvolution.html#rl_cleanup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pycudadecon.rl_cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Release GPU buffer and cleanup after deconvolution</p>
<p>Call this before program quits to release global GPUBuffer d_interpOTF.</p>
<ul class="simple">
<li><p>Resets any bleach corrections</p></li>
<li><p>Removes OTF from GPU buffer</p></li>
<li><p>Destroys cuFFT plan</p></li>
<li><p>Releases GPU buffers</p></li>
</ul>
</dd></dl>
<dl class="py function">
<dt id="pycudadecon.rl_decon">
<code class="sig-prename descclassname"><span class="pre">pycudadecon.</span></code><code class="sig-name descname"><span class="pre">rl_decon</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">background</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">80</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_deskewed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">napodize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nz_blend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad_val</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dup_rev_z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pycudadecon/deconvolution.html#rl_decon"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pycudadecon.rl_decon" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform Richardson Lucy Deconvolution.</p>
<p>Performs actual deconvolution. GPU must first be initialized with
<a class="reference internal" href="#pycudadecon.rl_init" title="pycudadecon.rl_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">pycudadecon.rl_init()</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>np.ndarray</em>) – 3D image volume to deconvolve</p></li>
<li><p><strong>background</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em> or </em><em>'auto'</em>) – User-supplied background to subtract. If ‘auto’, the median value of the
last Z plane will be used as background. by default 80</p></li>
<li><p><strong>n_iters</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Number of iterations, by default 10</p></li>
<li><p><strong>shift</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – If deskewed, the output image’s extra shift in X (positive-&gt;left),
by default 0</p></li>
<li><p><strong>save_deskewed</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – Save deskewed raw data as well as deconvolution result, by default False</p></li>
<li><p><strong>output_shape</strong> (<em>tuple of int</em><em>, </em><em>optional</em>) – Specify the output shape after deskewing.  Usually this is unnecessary and
can be autodetected.  Mostly intended for use within a
<a class="reference internal" href="#pycudadecon.RLContext" title="pycudadecon.RLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">pycudadecon.RLContext</span></code></a> context, by default None</p></li>
<li><p><strong>napodize</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Number of pixels to soften edge with, by default 15</p></li>
<li><p><strong>nz_blend</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Number of top and bottom sections to blend in to reduce axial ringing,
by default 0</p></li>
<li><p><strong>pad_val</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Value with which to pad image when deskewing, by default 0.0</p></li>
<li><p><strong>dup_rev_z</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – Duplicate reversed stack prior to decon to reduce axial ringing,
by default False</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The deconvolved result.  If <cite>save_deskewed</cite> is <cite>True</cite>, returns
<cite>(decon_result, deskew_result)</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray or 2-tuple of np.ndarray</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.9)"><strong>ValueError</strong></a> – If im.ndim is not 3, or <cite>output_shape</cite> is provided but not length 3</p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="pycudadecon.rl_init">
<code class="sig-prename descclassname"><span class="pre">pycudadecon.</span></code><code class="sig-name descname"><span class="pre">rl_init</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rawdata_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">otfpath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dzdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dxdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dzpsf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dxpsf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deskew</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pycudadecon/deconvolution.html#rl_init"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pycudadecon.rl_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize GPU for deconvolution.</p>
<p>Prepares cuFFT plan for deconvolution with a given data shape and OTF.
Must be used prior to <a class="reference internal" href="#pycudadecon.rl_decon" title="pycudadecon.rl_decon"><code class="xref py py-func docutils literal notranslate"><span class="pre">pycudadecon.rl_decon()</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rawdata_shape</strong> (<em>Tuple</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>]</em>) – 3-tuple of data shape</p></li>
<li><p><strong>otfpath</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Path to OTF TIF</p></li>
<li><p><strong>dzdata</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Z-step size of data, by default 0.5</p></li>
<li><p><strong>dxdata</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – XY pixel size of data, by default 0.1</p></li>
<li><p><strong>dzpsf</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Z-step size of the OTF, by default 0.1</p></li>
<li><p><strong>dxpsf</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – XY pixel size of the OTF, by default 0.1</p></li>
<li><p><strong>deskew</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Deskew angle. If not 0.0 then deskewing will be performed before
deconvolution, by default 0</p></li>
<li><p><strong>rotate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Rotation angle; if not 0.0 then rotation will be performed around Y
axis after deconvolution, by default 0</p></li>
<li><p><strong>width</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – If deskewed, the output image’s width, by default 0 (do not crop)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rl_init</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">otfpath</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decon_result</span> <span class="o">=</span> <span class="n">rl_decon</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rl_cleanup</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>
</div>
</div>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="otf.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Optical Transfer Functions</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="installation.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/deconvolution.md"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Deconvolution</a><ul>
<li><a class="reference internal" href="#module-pycudadecon">API</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>